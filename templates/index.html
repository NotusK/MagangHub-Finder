{% extends "base.html" %}

{% block content %}
<div class="search-section">
    <form id="searchForm" method="POST" action="/search">
        <div class="form-group">
            <label for="jurusan">Jurusan</label>
            <select id="jurusan" name="jurusan" required>
                <option value="">-- Pilih Jurusan --</option>
                <option value="Informatika">Informatika</option>
                <option value="Ilmu Komunikasi">Ilmu Komunikasi</option>
                <option value="Hubungan Internasional">Hubungan Internasional</option>
                <option value="Manajemen">Manajemen</option>
                <option value="Administrasi">Administrasi</option>
                <option value="Administrasi Bisnis">Administrasi Bisnis</option>
                <option value="Elektro">Elektro</option>
            </select>
        </div>

        <div class="form-group">
            <label for="provinsi">Provinsi</label>
            <select id="provinsi" name="provinsi" required>
                <option value="">-- Pilih Provinsi --</option>
                <option value="11">Aceh</option>
                <option value="12">Sumatera Utara</option>
                <option value="13">Sumatera Barat</option>
                <option value="14">Riau</option>
                <option value="15">Jambi</option>
                <option value="16">Sumatera Selatan</option>
                <option value="17">Bengkulu</option>
                <option value="18">Lampung</option>
                <option value="19">Kepulauan Bangka Belitung</option>
                <option value="21">Kepulauan Riau</option>
                <option value="31">DKI Jakarta</option>
                <option value="32">Jawa Barat</option>
                <option value="33">Jawa Tengah</option>
                <option value="34">DI Yogyakarta</option>
                <option value="35">Jawa Timur</option>
                <option value="36">Banten</option>
                <option value="51">Bali</option>
                <option value="52">Nusa Tenggara Barat</option>
                <option value="53">Nusa Tenggara Timur</option>
                <option value="61">Kalimantan Barat</option>
                <option value="62">Kalimantan Tengah</option>
                <option value="63">Kalimantan Selatan</option>
                <option value="64">Kalimantan Timur</option>
                <option value="65">Kalimantan Utara</option>
                <option value="71">Sulawesi Utara</option>
                <option value="72">Sulawesi Tengah</option>
                <option value="73">Sulawesi Selatan</option>
                <option value="74">Sulawesi Tenggara</option>
                <option value="75">Gorontalo</option>
                <option value="76">Sulawesi Barat</option>
                <option value="81">Maluku</option>
                <option value="82">Maluku Utara</option>
                <option value="91">Papua Barat</option>
                <option value="94">Papua</option>
            </select>
        </div>

        <div class="form-group">
            <label>Kabupaten/Kota</label>
            <div id="kabupatenContainer" class="checkbox-container">
                <p class="empty-message">Pilih provinsi terlebih dahulu</p>
            </div>
            <small>Pilih satu atau lebih kabupaten/kota</small>
        </div>

        <button type="submit" class="btn-primary">
            <span id="btnText">Cari Lowongan</span>
            <span id="btnLoading" style="display: none;">Mencari...</span>
        </button>
    </form>
</div>

<div id="results" class="results-section" style="display: none;">
    <div class="results-header">
        <h2>Hasil Pencarian</h2>
        <p id="resultsCount"></p>
    </div>
    <div id="resultsList"></div>
</div>

<div id="errorMessage" class="error-message" style="display: none;"></div>
{% endblock %}

{% block scripts %}
<script>
// Kabupaten/Kota data by province
const kabupatenData = {
    '11': ['KAB. ACEH BARAT', 'KAB. ACEH BARAT DAYA', 'KAB. ACEH BESAR', 'KAB. ACEH JAYA', 'KAB. ACEH SELATAN', 'KAB. ACEH SINGKIL', 'KAB. ACEH TAMIANG', 'KAB. ACEH TENGAH', 'KAB. ACEH TENGGARA', 'KAB. ACEH TIMUR', 'KAB. ACEH UTARA', 'KAB. BENER MERIAH', 'KAB. BIREUEN', 'KAB. GAYO LUES', 'KAB. NAGAN RAYA', 'KAB. PIDIE', 'KAB. PIDIE JAYA', 'KAB. SIMEULUE', 'KOTA BANDA ACEH', 'KOTA LANGSA', 'KOTA LHOKSEUMAWE', 'KOTA SABANG', 'KOTA SUBULUSSALAM'],
    '12': ['KAB. ASAHAN', 'KAB. BATU BARA', 'KAB. DAIRI', 'KAB. DELI SERDANG', 'KAB. HUMBANG HASUNDUTAN', 'KAB. KARO', 'KAB. LABUHANBATU', 'KAB. LABUHANBATU SELATAN', 'KAB. LABUHANBATU UTARA', 'KAB. LANGKAT', 'KAB. MANDAILING NATAL', 'KAB. NIAS', 'KAB. NIAS BARAT', 'KAB. NIAS SELATAN', 'KAB. NIAS UTARA', 'KAB. PADANG LAWAS', 'KAB. PADANG LAWAS UTARA', 'KAB. PAKPAK BHARAT', 'KAB. SAMOSIR', 'KAB. SERDANG BEDAGAI', 'KAB. SIMALUNGUN', 'KAB. TAPANULI SELATAN', 'KAB. TAPANULI TENGAH', 'KAB. TAPANULI UTARA', 'KAB. TOBA SAMOSIR', 'KOTA BINJAI', 'KOTA GUNUNGSITOLI', 'KOTA MEDAN', 'KOTA PADANG SIDEMPUAN', 'KOTA PEMATANGSIANTAR', 'KOTA SIBOLGA', 'KOTA TANJUNGBALAI', 'KOTA TEBING TINGGI'],
    '13': ['KAB. AGAM', 'KAB. DHARMASRAYA', 'KAB. KEPULAUAN MENTAWAI', 'KAB. LIMA PULUH KOTA', 'KAB. PADANG PARIAMAN', 'KAB. PASAMAN', 'KAB. PASAMAN BARAT', 'KAB. PESISIR SELATAN', 'KAB. SIJUNJUNG', 'KAB. SOLOK', 'KAB. SOLOK SELATAN', 'KAB. TANAH DATAR', 'KOTA BUKITTINGGI', 'KOTA PADANG', 'KOTA PADANG PANJANG', 'KOTA PARIAMAN', 'KOTA PAYAKUMBUH', 'KOTA SAWAHLUNTO', 'KOTA SOLOK'],
    '14': ['KAB. BENGKALIS', 'KAB. INDRAGIRI HILIR', 'KAB. INDRAGIRI HULU', 'KAB. KAMPAR', 'KAB. KEPULAUAN MERANTI', 'KAB. KUANTAN SINGINGI', 'KAB. PELALAWAN', 'KAB. ROKAN HILIR', 'KAB. ROKAN HULU', 'KAB. SIAK', 'KOTA DUMAI', 'KOTA PEKANBARU'],
    '15': ['KAB. BATANG HARI', 'KAB. BUNGO', 'KAB. KERINCI', 'KAB. MERANGIN', 'KAB. MUARO JAMBI', 'KAB. SAROLANGUN', 'KAB. TANJUNG JABUNG BARAT', 'KAB. TANJUNG JABUNG TIMUR', 'KAB. TEBO', 'KOTA JAMBI', 'KOTA SUNGAI PENUH'],
    '16': ['KAB. BANYUASIN', 'KAB. EMPAT LAWANG', 'KAB. LAHAT', 'KAB. MUARA ENIM', 'KAB. MUSI BANYUASIN', 'KAB. MUSI RAWAS', 'KAB. MUSI RAWAS UTARA', 'KAB. OGAN ILIR', 'KAB. OGAN KOMERING ILIR', 'KAB. OGAN KOMERING ULU', 'KAB. OGAN KOMERING ULU SELATAN', 'KAB. OGAN KOMERING ULU TIMUR', 'KAB. PENUKAL ABAB LEMATANG ILIR', 'KOTA LUBUKLINGGAU', 'KOTA PAGAR ALAM', 'KOTA PALEMBANG', 'KOTA PRABUMULIH'],
    '17': ['KAB. BENGKULU SELATAN', 'KAB. BENGKULU TENGAH', 'KAB. BENGKULU UTARA', 'KAB. KAUR', 'KAB. KEPAHIANG', 'KAB. LEBONG', 'KAB. MUKOMUKO', 'KAB. REJANG LEBONG', 'KAB. SELUMA', 'KOTA BENGKULU'],
    '18': ['KAB. LAMPUNG BARAT', 'KAB. LAMPUNG SELATAN', 'KAB. LAMPUNG TENGAH', 'KAB. LAMPUNG TIMUR', 'KAB. LAMPUNG UTARA', 'KAB. MESUJI', 'KAB. PESAWARAN', 'KAB. PESISIR BARAT', 'KAB. PRINGSEWU', 'KAB. TANGGAMUS', 'KAB. TULANG BAWANG', 'KAB. TULANG BAWANG BARAT', 'KAB. WAY KANAN', 'KOTA BANDAR LAMPUNG', 'KOTA METRO'],
    '19': ['KAB. BANGKA', 'KAB. BANGKA BARAT', 'KAB. BANGKA SELATAN', 'KAB. BANGKA TENGAH', 'KAB. BELITUNG', 'KAB. BELITUNG TIMUR', 'KOTA PANGKAL PINANG'],
    '21': ['KAB. BINTAN', 'KAB. KARIMUN', 'KAB. KEPULAUAN ANAMBAS', 'KAB. LINGGA', 'KAB. NATUNA', 'KOTA BATAM', 'KOTA TANJUNG PINANG'],
    '31': ['KAB. KEPULAUAN SERIBU', 'KOTA JAKARTA BARAT', 'KOTA JAKARTA PUSAT', 'KOTA JAKARTA SELATAN', 'KOTA JAKARTA TIMUR', 'KOTA JAKARTA UTARA'],
    '32': ['KAB. BANDUNG', 'KAB. BANDUNG BARAT', 'KAB. BEKASI', 'KAB. BOGOR', 'KAB. CIAMIS', 'KAB. CIANJUR', 'KAB. CIREBON', 'KAB. GARUT', 'KAB. INDRAMAYU', 'KAB. KARAWANG', 'KAB. KUNINGAN', 'KAB. MAJALENGKA', 'KAB. PANGANDARAN', 'KAB. PURWAKARTA', 'KAB. SUBANG', 'KAB. SUKABUMI', 'KAB. SUMEDANG', 'KAB. TASIKMALAYA', 'KOTA BANDUNG', 'KOTA BANJAR', 'KOTA BEKASI', 'KOTA BOGOR', 'KOTA CIMAHI', 'KOTA CIREBON', 'KOTA DEPOK', 'KOTA SUKABUMI', 'KOTA TASIKMALAYA'],
    '33': ['KAB. BANJARNEGARA', 'KAB. BANYUMAS', 'KAB. BATANG', 'KAB. BLORA', 'KAB. BOYOLALI', 'KAB. BREBES', 'KAB. CILACAP', 'KAB. DEMAK', 'KAB. GROBOGAN', 'KAB. JEPARA', 'KAB. KARANGANYAR', 'KAB. KEBUMEN', 'KAB. KENDAL', 'KAB. KLATEN', 'KAB. KUDUS', 'KAB. MAGELANG', 'KAB. PATI', 'KAB. PEKALONGAN', 'KAB. PEMALANG', 'KAB. PURBALINGGA', 'KAB. PURWOREJO', 'KAB. REMBANG', 'KAB. SEMARANG', 'KAB. SRAGEN', 'KAB. SUKOHARJO', 'KAB. TEGAL', 'KAB. TEMANGGUNG', 'KAB. WONOGIRI', 'KAB. WONOSOBO', 'KOTA MAGELANG', 'KOTA PEKALONGAN', 'KOTA SALATIGA', 'KOTA SEMARANG', 'KOTA SURAKARTA', 'KOTA TEGAL'],
    '34': ['KAB. BANTUL', 'KAB. GUNUNG KIDUL', 'KAB. KULON PROGO', 'KAB. SLEMAN', 'KOTA YOGYAKARTA'],
    '35': ['KAB. BANGKALAN', 'KAB. BANYUWANGI', 'KAB. BLITAR', 'KAB. BOJONEGORO', 'KAB. BONDOWOSO', 'KAB. GRESIK', 'KAB. JEMBER', 'KAB. JOMBANG', 'KAB. KEDIRI', 'KAB. LAMONGAN', 'KAB. LUMAJANG', 'KAB. MADIUN', 'KAB. MAGETAN', 'KAB. MALANG', 'KAB. MOJOKERTO', 'KAB. NGANJUK', 'KAB. NGAWI', 'KAB. PACITAN', 'KAB. PAMEKASAN', 'KAB. PASURUAN', 'KAB. PONOROGO', 'KAB. PROBOLINGGO', 'KAB. SAMPANG', 'KAB. SIDOARJO', 'KAB. SITUBONDO', 'KAB. SUMENEP', 'KAB. TRENGGALEK', 'KAB. TUBAN', 'KAB. TULUNGAGUNG', 'KOTA BATU', 'KOTA BLITAR', 'KOTA KEDIRI', 'KOTA MADIUN', 'KOTA MALANG', 'KOTA MOJOKERTO', 'KOTA PASURUAN', 'KOTA PROBOLINGGO', 'KOTA SURABAYA'],
    '36': ['KAB. LEBAK', 'KAB. PANDEGLANG', 'KAB. SERANG', 'KAB. TANGERANG', 'KOTA CILEGON', 'KOTA SERANG', 'KOTA TANGERANG', 'KOTA TANGERANG SELATAN'],
    '51': ['KAB. BADUNG', 'KAB. BANGLI', 'KAB. BULELENG', 'KAB. GIANYAR', 'KAB. JEMBRANA', 'KAB. KARANGASEM', 'KAB. KLUNGKUNG', 'KAB. TABANAN', 'KOTA DENPASAR'],
    '52': ['KAB. BIMA', 'KAB. DOMPU', 'KAB. LOMBOK BARAT', 'KAB. LOMBOK TENGAH', 'KAB. LOMBOK TIMUR', 'KAB. LOMBOK UTARA', 'KAB. SUMBAWA', 'KAB. SUMBAWA BARAT', 'KOTA BIMA', 'KOTA MATARAM'],
    '53': ['KAB. ALOR', 'KAB. BELU', 'KAB. ENDE', 'KAB. FLORES TIMUR', 'KAB. KUPANG', 'KAB. LEMBATA', 'KAB. MALAKA', 'KAB. MANGGARAI', 'KAB. MANGGARAI BARAT', 'KAB. MANGGARAI TIMUR', 'KAB. NAGEKEO', 'KAB. NGADA', 'KAB. ROTE NDAO', 'KAB. SABU RAIJUA', 'KAB. SIKKA', 'KAB. SUMBA BARAT', 'KAB. SUMBA BARAT DAYA', 'KAB. SUMBA TENGAH', 'KAB. SUMBA TIMUR', 'KAB. TIMOR TENGAH SELATAN', 'KAB. TIMOR TENGAH UTARA', 'KOTA KUPANG'],
    '61': ['KAB. BENGKAYANG', 'KAB. KAPUAS HULU', 'KAB. KAYONG UTARA', 'KAB. KETAPANG', 'KAB. KUBU RAYA', 'KAB. LANDAK', 'KAB. MELAWI', 'KAB. MEMPAWAH', 'KAB. SAMBAS', 'KAB. SANGGAU', 'KAB. SEKADAU', 'KAB. SINTANG', 'KOTA PONTIANAK', 'KOTA SINGKAWANG'],
    '62': ['KAB. BARITO SELATAN', 'KAB. BARITO TIMUR', 'KAB. BARITO UTARA', 'KAB. GUNUNG MAS', 'KAB. KAPUAS', 'KAB. KATINGAN', 'KAB. KOTAWARINGIN BARAT', 'KAB. KOTAWARINGIN TIMUR', 'KAB. LAMANDAU', 'KAB. MURUNG RAYA', 'KAB. PULANG PISAU', 'KAB. SERUYAN', 'KAB. SUKAMARA', 'KOTA PALANGKA RAYA'],
    '63': ['KAB. BALANGAN', 'KAB. BANJAR', 'KAB. BARITO KUALA', 'KAB. HULU SUNGAI SELATAN', 'KAB. HULU SUNGAI TENGAH', 'KAB. HULU SUNGAI UTARA', 'KAB. KOTABARU', 'KAB. TABALONG', 'KAB. TANAH BUMBU', 'KAB. TANAH LAUT', 'KAB. TAPIN', 'KOTA BANJARBARU', 'KOTA BANJARMASIN'],
    '64': ['KAB. BERAU', 'KAB. KUTAI BARAT', 'KAB. KUTAI KARTANEGARA', 'KAB. KUTAI TIMUR', 'KAB. MAHAKAM ULU', 'KAB. PASER', 'KAB. PENAJAM PASER UTARA', 'KOTA BALIKPAPAN', 'KOTA BONTANG', 'KOTA SAMARINDA'],
    '65': ['KAB. BULUNGAN', 'KAB. MALINAU', 'KAB. NUNUKAN', 'KAB. TANA TIDUNG', 'KOTA TARAKAN'],
    '71': ['KAB. BOLAANG MONGONDOW', 'KAB. BOLAANG MONGONDOW SELATAN', 'KAB. BOLAANG MONGONDOW TIMUR', 'KAB. BOLAANG MONGONDOW UTARA', 'KAB. KEPULAUAN SANGIHE', 'KAB. KEPULAUAN SIAU TAGULANDANG BIARO', 'KAB. KEPULAUAN TALAUD', 'KAB. MINAHASA', 'KAB. MINAHASA SELATAN', 'KAB. MINAHASA TENGGARA', 'KAB. MINAHASA UTARA', 'KOTA BITUNG', 'KOTA KOTAMOBAGU', 'KOTA MANADO', 'KOTA TOMOHON'],
    '72': ['KAB. BANGGAI', 'KAB. BANGGAI KEPULAUAN', 'KAB. BANGGAI LAUT', 'KAB. BUOL', 'KAB. DONGGALA', 'KAB. MOROWALI', 'KAB. MOROWALI UTARA', 'KAB. PARIGI MOUTONG', 'KAB. POSO', 'KAB. SIGI', 'KAB. TOJO UNA-UNA', 'KAB. TOLI-TOLI', 'KOTA PALU'],
    '73': ['KAB. BANTAENG', 'KAB. BARRU', 'KAB. BONE', 'KAB. BULUKUMBA', 'KAB. ENREKANG', 'KAB. GOWA', 'KAB. JENEPONTO', 'KAB. KEPULAUAN SELAYAR', 'KAB. LUWU', 'KAB. LUWU TIMUR', 'KAB. LUWU UTARA', 'KAB. MAROS', 'KAB. PANGKAJENE DAN KEPULAUAN', 'KAB. PINRANG', 'KAB. SIDENRENG RAPPANG', 'KAB. SINJAI', 'KAB. SOPPENG', 'KAB. TAKALAR', 'KAB. TANA TORAJA', 'KAB. TORAJA UTARA', 'KAB. WAJO', 'KOTA MAKASSAR', 'KOTA PALOPO', 'KOTA PAREPARE'],
    '74': ['KAB. BOMBANA', 'KAB. BUTON', 'KAB. BUTON SELATAN', 'KAB. BUTON TENGAH', 'KAB. BUTON UTARA', 'KAB. KOLAKA', 'KAB. KOLAKA TIMUR', 'KAB. KOLAKA UTARA', 'KAB. KONAWE', 'KAB. KONAWE KEPULAUAN', 'KAB. KONAWE SELATAN', 'KAB. KONAWE UTARA', 'KAB. MUNA', 'KAB. MUNA BARAT', 'KAB. WAKATOBI', 'KOTA BAU-BAU', 'KOTA KENDARI'],
    '75': ['KAB. BONE BOLANGO', 'KAB. BOALEMO', 'KAB. GORONTALO', 'KAB. GORONTALO UTARA', 'KAB. POHUWATO', 'KOTA GORONTALO'],
    '76': ['KAB. MAJENE', 'KAB. MAMASA', 'KAB. MAMUJU', 'KAB. MAMUJU TENGAH', 'KAB. MAMUJU UTARA', 'KAB. POLEWALI MANDAR'],
    '81': ['KAB. BURU', 'KAB. BURU SELATAN', 'KAB. KEPULAUAN ARU', 'KAB. MALUKU BARAT DAYA', 'KAB. MALUKU TENGAH', 'KAB. MALUKU TENGGARA', 'KAB. MALUKU TENGGARA BARAT', 'KAB. SERAM BAGIAN BARAT', 'KAB. SERAM BAGIAN TIMUR', 'KOTA AMBON', 'KOTA TUAL'],
    '82': ['KAB. HALMAHERA BARAT', 'KAB. HALMAHERA SELATAN', 'KAB. HALMAHERA TENGAH', 'KAB. HALMAHERA TIMUR', 'KAB. HALMAHERA UTARA', 'KAB. KEPULAUAN SULA', 'KAB. PULAU MOROTAI', 'KAB. PULAU TALIABU', 'KOTA TERNATE', 'KOTA TIDORE KEPULAUAN'],
    '91': ['KAB. FAKFAK', 'KAB. KAIMANA', 'KAB. MANOKWARI', 'KAB. MANOKWARI SELATAN', 'KAB. MAYBRAT', 'KAB. PEGUNUNGAN ARFAK', 'KAB. RAJA AMPAT', 'KAB. SORONG', 'KAB. SORONG SELATAN', 'KAB. TAMBRAUW', 'KAB. TELUK BINTUNI', 'KAB. TELUK WONDAMA', 'KOTA SORONG'],
    '94': ['KAB. ASMAT', 'KAB. BIAK NUMFOR', 'KAB. BOVEN DIGOEL', 'KAB. DEIYAI', 'KAB. DOGIYAI', 'KAB. INTAN JAYA', 'KAB. JAYAPURA', 'KAB. JAYAWIJAYA', 'KAB. KEEROM', 'KAB. KEPULAUAN YAPEN', 'KAB. LANNY JAYA', 'KAB. MAMBERAMO RAYA', 'KAB. MAMBERAMO TENGAH', 'KAB. MAPPI', 'KAB. MERAUKE', 'KAB. MIMIKA', 'KAB. NABIRE', 'KAB. NDUGA', 'KAB. PANIAI', 'KAB. PEGUNUNGAN BINTANG', 'KAB. PUNCAK', 'KAB. PUNCAK JAYA', 'KAB. SARMI', 'KAB. SUPIORI', 'KAB. TOLIKARA', 'KAB. WAROPEN', 'KAB. YAHUKIMO', 'KAB. YALIMO', 'KOTA JAYAPURA']
};

// Update kabupaten dropdown when provinsi changes
document.getElementById('provinsi').addEventListener('change', function() {
    const kabupatenContainer = document.getElementById('kabupatenContainer');
    const provinsiCode = this.value;
    
    // Clear current content
    kabupatenContainer.innerHTML = '';
    
    if (provinsiCode && kabupatenData[provinsiCode]) {
        // Add "Select All" checkbox
        const selectAllDiv = document.createElement('div');
        selectAllDiv.className = 'checkbox-item select-all';
        selectAllDiv.innerHTML = `
            <label>
                <input type="checkbox" id="selectAll" class="select-all-checkbox">
                <span class="checkbox-label"><strong>Pilih Semua</strong></span>
            </label>
        `;
        kabupatenContainer.appendChild(selectAllDiv);
        
        // Add separator
        const separator = document.createElement('hr');
        separator.style.margin = '10px 0';
        separator.style.border = 'none';
        separator.style.borderTop = '1px solid #e0e0e0';
        kabupatenContainer.appendChild(separator);
        
        // Add kabupaten checkboxes
        kabupatenData[provinsiCode].forEach((kab, index) => {
            const checkboxDiv = document.createElement('div');
            checkboxDiv.className = 'checkbox-item';
            checkboxDiv.innerHTML = `
                <label>
                    <input type="checkbox" name="kabupaten[]" value="${kab}" class="kabupaten-checkbox">
                    <span class="checkbox-label">${kab}</span>
                </label>
            `;
            kabupatenContainer.appendChild(checkboxDiv);
        });
        
        // Add "Select All" functionality
        document.getElementById('selectAll').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.kabupaten-checkbox');
            checkboxes.forEach(cb => cb.checked = this.checked);
        });
        
        // Update "Select All" state when individual checkboxes change
        document.querySelectorAll('.kabupaten-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const allCheckboxes = document.querySelectorAll('.kabupaten-checkbox');
                const checkedCheckboxes = document.querySelectorAll('.kabupaten-checkbox:checked');
                const selectAllCheckbox = document.getElementById('selectAll');
                selectAllCheckbox.checked = allCheckboxes.length === checkedCheckboxes.length;
            });
        });
    } else {
        // Default message
        const message = document.createElement('p');
        message.className = 'empty-message';
        message.textContent = 'Pilih provinsi terlebih dahulu';
        kabupatenContainer.appendChild(message);
    }
});

document.getElementById('searchForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const btnText = document.getElementById('btnText');
    const btnLoading = document.getElementById('btnLoading');
    const results = document.getElementById('results');
    const resultsList = document.getElementById('resultsList');
    const resultsCount = document.getElementById('resultsCount');
    const errorMessage = document.getElementById('errorMessage');
    
    btnText.style.display = 'none';
    btnLoading.style.display = 'inline';
    results.style.display = 'none';
    errorMessage.style.display = 'none';
    
    const formData = new FormData(e.target);
    
    // Get all selected kabupaten values
    const selectedKabupaten = Array.from(document.querySelectorAll('.kabupaten-checkbox:checked'))
        .map(checkbox => checkbox.value);
    
    // Validate at least one kabupaten is selected
    if (selectedKabupaten.length === 0) {
        errorMessage.textContent = 'Pilih minimal satu kabupaten/kota';
        errorMessage.style.display = 'block';
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
        return;
    }
    
    // Add kabupaten as comma-separated string
    formData.append('kabupaten', selectedKabupaten.join(','));
    
    try {
        const response = await fetch('/search', {
            method: 'POST',
            body: formData
        });
        
        const data = await response.json();
        
        if (data.error) {
            errorMessage.textContent = data.error;
            errorMessage.style.display = 'block';
        } else {
            resultsCount.textContent = `Ditemukan ${data.count} lowongan`;
            resultsList.innerHTML = data.results.map((item, index) => `
                <div class="result-card">
                    <div class="result-number">${index + 1}</div>
                    <div class="result-content">
                        <h3>${item.posisi}</h3>
                        <p class="company">${item.nama_perusahaan}</p>
                        <div class="result-details">
                            <span class="badge">${item.nama_kabupaten}</span>
                            <span class="quota">Kuota: ${item.jumlah_kuota} | Terdaftar: ${item.jumlah_terdaftar}</span>
                        </div>
                        <a href="https://maganghub.kemnaker.go.id/lowongan/view/${item.id_posisi}" target="_blank" class="btn-link">
                            Lihat Detail â†’
                        </a>
                    </div>
                </div>
            `).join('');
            results.style.display = 'block';
            results.scrollIntoView({ behavior: 'smooth' });
        }
    } catch (error) {
        errorMessage.textContent = 'Terjadi kesalahan saat mencari lowongan. Silakan coba lagi.';
        errorMessage.style.display = 'block';
    } finally {
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
    }
});
</script>
{% endblock %}